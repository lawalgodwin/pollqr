| Feature ID | Description                                               |                                                                                                                                                    User Story | Expected Behavior / Outcome                                                                                                                                                                                                                                                    |
| ---------- | --------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------: | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| FR001      | Create a new poll (title, description, options)           |                 As a **poll creator**, I want to create a poll with a title, description, and at least two options so that I can collect votes on a question. | The system accepts a POST with title, description and ≥2 options. Returns `201 Created` with `pollId`, `shortUrl` and `qrToken`. Validation rejects submissions with missing title or <2 options (HTTP 400). Idempotent if `client_creation_id` header is provided.            |
| FR002      | Poll configuration (type, multi-select limit, visibility) |                     As a **poll creator**, I want to configure poll type (single/multi), set max selections, and visibility so that voting enforces my rules. | Poll stores `type`, `maxSelections` and `visibility`. Voting UI enforces `maxSelections`. Server rejects invalid votes exceeding limits (HTTP 422). Visibility rules (public/private/auth-required) are enforced on `GET /api/polls/:id`.                                      |
| FR003      | Start/end scheduling & timezone handling                  |                                             As a **poll creator**, I want to set start and end times so the poll only accepts votes during the active window. | Timestamps accepted in ISO format and stored in UTC. Server uses UTC to enforce start/end. Requests outside the active window are rejected with clear messages. UI displays localized times and a countdown where appropriate.                                                 |
| FR004      | Generate static QR (encode direct URL)                    |                                                         As a **poll creator**, I want a static QR image that encodes the poll URL so I can print or embed it. | System produces PNG/SVG/PDF encoding the short URL. Download link provided. Scanning the QR redirects directly to the poll URL. Conflicts (slug exists) return 409 with suggested slugs.                                                                                       |
| FR005      | Generate dynamic QR (repointable token)                   |                                                As a **poll creator**, I want a dynamic QR token that can be repointed later so I can reuse printed materials. | System creates `qrToken -> pollId` mapping. `GET /r/{qrToken}` resolves to current poll. Repointing updates mapping atomically and is logged. Old printed QRs start resolving to the new target immediately.                                                                   |
| FR006      | Short shareable URL & customizable slug                   |                                                  As a **poll creator**, I want a short URL and optional slug so I can share it easily and customize branding. | System returns a short URL. When a slug is requested, server checks uniqueness and returns 201 or 409. Short URL resolves identically to QR and honors visibility/auth.                                                                                                        |
| FR007      | Downloadable QR assets (PNG/SVG/PDF)                      |                                                          As a **poll creator**, I want to download high-quality vector or raster QR assets for print and web. | System offers downloads in PNG, SVG, and PDF. SVG/PDF are high-resolution and suitable for printing. Download counts logged for analytics.                                                                                                                                     |
| FR008      | Mobile-friendly voting UI                                 |                                                                As a **voter**, I want a mobile-friendly voting page so I can scan and submit my vote quickly. | Voting page renders responsively on mobile. Controls (radio/checkbox) match poll type. Accessibility standards applied. Page loads within acceptable performance metrics (e.g., <2s on mobile 3G simulated conditions).                                                        |
| FR009      | Submit single-choice vote                                 |                                                                           As a **voter**, I want to select one option and submit so my preference is counted. | POST `/api/polls/:id/vote` with `option_ids` containing a single id returns `201 Created` and `receipt_id`. Option counts increment atomically. Duplicate submissions with same `client_vote_id` return same receipt and do not double-count.                                  |
| FR010      | Submit multi-choice vote with max selections              |                                           As a **voter**, I want to select multiple options up to the configured limit so I can express multiple preferences. | UI prevents selecting more than `maxSelections`. Server rejects submissions with >`maxSelections` (HTTP 422). Valid multi-select votes accepted and each chosen option's count increments.                                                                                     |
| FR011      | Idempotency & retry-safe voting                           |                                             As a **voter**, I want retries to be safe so repeated submissions (network retries) don't create duplicate votes. | Clients send `Idempotency-Key` or `client_vote_id`. Server stores idempotency keys (Redis) and returns existing receipt for repeated keys. Retries are safe; the vote is recorded only once.                                                                                   |
| FR012      | Authentication-required voting                            |                                                    As an **organizer**, I want to require authenticated voting for some polls so I can verify voter identity. | If poll requires auth, unauthenticated requests redirect to login/verify. After successful auth, flow returns user to vote. Server enforces single-vote-per-identity if configured.                                                                                            |
| FR013      | Anonymous voting option                                   |                                                                   As an **organizer**, I want to allow anonymous voting so users can vote without logging in. | When anonymous is enabled, server accepts votes without `voter_id` and logs minimal metadata (timestamp, IP) for fraud detection. Personal data not stored unless explicitly requested.                                                                                        |
| FR014      | Prevent basic duplicate/fraudulent votes                  |                                                              As a **system**, I want to block obvious duplicate votes so vote counts are reasonably accurate. | System applies heuristics (cookie, IP rate-limit, device fingerprint). Suspicious activity triggers progressive challenge (CAPTCHA) or verification. Legitimate multiple users behind NAT are not blocked outright—heuristics escalate to verification rather than hard block. |
| FR015      | Advanced anti-fraud escalation                            |                                                     As a **system admin**, I want suspicious votes quarantined for review so I can maintain result integrity. | Votes flagged by heuristics are marked `pending_review` and do not count toward public tallies until verified. Admin dashboard surfaces flagged votes for manual review.                                                                                                       |
| FR016      | Write-in / "Other" option and moderation                  |                                                  As a **voter**, I want to submit a write-in option when my choice isn't listed so my preference is recorded. | If `allowWriteIn` is enabled, `write_in` text accepted with length/character limits. Write-ins are stored but hidden from public results until approved by creator/moderator. Moderation queue available in admin UI.                                                          |
| FR017      | Results visibility control & reveal timing                |                                        As a **poll creator**, I want to hide results until poll close or reveal at chosen time so I can avoid biasing voters. | Creator sets `resultsVisibility`: public/live/hidden-until-close/creator-only. If hidden, requests to results return HTTP 403 or a “results hidden” message until policy allows reveal. System auto-reveals when `endAt` passes if configured.                                 |
| FR018      | Real-time / near-real-time results with caching           |                           As a **viewer**, I want to see near-real-time results without overwhelming backend so the results feel fresh and the system scales. | Results endpoint supports caching and incremental updates (WebSocket or polling). Counts are eventually consistent within a configurable window (e.g., <5s). Cache invalidation occurs on vote acceptance.                                                                     |
| FR019      | Creator analytics & exports (CSV/JSON)                    |                                                                 As a **poll creator**, I want analytics and raw exports so I can audit and analyze responses. | Owner can view scan → vote funnel, hourly metrics, and download CSV/JSON with vote timestamps and anonymized voter ids (when anonymous). Exports respect privacy settings and data retention policies.                                                                         |
| FR020      | Audit log for admin actions                               |                                                                      As a **system**, I want immutable audit logs for admin actions so changes are traceable. | All admin actions (create/edit/repoint/close/revoke) write an immutable `AuditLog` entry with actor, timestamp, and payload. Logs cannot be modified via UI; exports available to auditors.                                                                                    |
| FR021      | Repoint dynamic QR                                        |                                                 As a **poll creator**, I want to repoint a dynamic QR to another poll or landing page so I can reuse signage. | `POST /api/qrcodes/{qrToken}/repoint` updates mapping. The action requires ownership/authz. Repoint events recorded in audit log. Subsequent scans resolve to the new target immediately.                                                                                      |
| FR022      | Revoke / expire QR tokens                                 |                                             As a **poll creator**, I want to deactivate or expire QR tokens so I can stop access from a printed QR if needed. | `POST /api/qrcodes/{qrToken}/deactivate` marks token inactive. Scans return an “expired or revoked” page. Deactivation recorded in audit log.                                                                                                                                  |
| FR023      | Edit poll metadata prior to first vote                    |                                                 As a **poll creator**, I want to edit title/description/options before votes exist so I can correct mistakes. | If no votes exist, edits to title/description/options are allowed, persisted, and recorded in audit log. If votes exist, option deletion is blocked; editing restrictions apply and are logged.                                                                                |
| FR024      | Prevent option changes after votes (versioning)           |                                                      As a **system**, I want to prevent destructive changes after votes so historical integrity is preserved. | Once votes exist, option removal or rewriting is disallowed. If a change is needed, a new poll version can be created and prior votes remain attached to the old version.                                                                                                      |
| FR025      | Export & privacy-compliant deletion                       |                                                                As a **user**, I want to export my poll data and request deletion so we comply with GDPR/CCPA. | Creator or authorized users can export data; data deletion requests follow a documented workflow. Deletion results in pseudonymization or removal per legal policy and is logged.                                                                                              |
| FR026      | Scan tracking & funnel analytics                          |                                                           As a **product manager**, I want scan and conversion metrics so I can measure campaign performance. | Each QR resolve records `scanId`, timestamp, IP, UA, and conversion flag (if vote follows). Aggregated funnel metrics (scans, opens, votes, conversion %) are available with time breakdowns. PII is only stored with consent.                                                 |
| FR027      | Offline vote caching & resume/retry                       |                                                                        As a **voter**, I want retry-safe voting if my connection drops so my vote isn't lost. | Client caches vote and retries with same `client_vote_id` after connectivity resumes. Server handles idempotency and returns a receipt once accepted. If offline mode is supported, votes queue locally and sync when online.                                                  |
| FR028      | API contract & Idempotency requirement                    | As an **integration developer**, I want a stable API contract where create/vote endpoints require idempotency keys so integrators can build reliable clients. | OpenAPI spec documents endpoints. `POST /api/polls` and `POST /api/polls/:id/vote` expect `Idempotency-Key`/`client_vote_id`. Server returns `409`/existing resource when duplicate key is used.                                                                               |
| FR029      | Admin controls: close/pause/reopen polls                  |                                                            As a **poll creator**, I want to manually close, pause, or reopen polls to control voting windows. | Admin UI exposes close/pause/reopen actions. Closed polls reject vote submissions. Reopening allowed per policy and recorded in audit log.                                                                                                                                     |
| FR030      | Rate limiting, quotas & scaling protections               |                                                                 As an **operator**, I want rate limits and quotas to protect the service under load or abuse. | IP/account rate limits enforced; quotas per user (max active polls) return `429` when exceeded. Monitoring alerts on breach. Rate-limits configurable per plan.                                                                                                                |
| FR031      | Accessibility & internationalization                      |                                                  As a **voter** with assistive needs\*\*, I want accessible UI and multi-language support so anyone can vote. | UI meets WCAG basics (keyboard nav, ARIA labels). Static strings externalized for i18n. RTL languages supported. Accessibility tests included in CI.                                                                                                                           |
| FR032      | QR branding & customization                               |                                                                      As a **poll creator**, I want to add logo/colors to QR assets so branding is consistent. | System allows embedding a small logo and color accent in QR preview. Generated QR remains scannable; validation ensures contrast and margin rules for reliable scanning.                                                                                                       |
| FR033      | Monitoring, alerts & error reporting                      |                                                          As an **operator**, I want monitoring and alerting so we can respond to outages or abnormal traffic. | Prometheus/Grafana dashboards and Sentry alerts for errors. Thresholds configured for voting endpoint latency, error rate, high fraud flagging, and rate-limit events.                                                                                                         |
| FR034      | E2E tests & mutation testing coverage                     |                                          As a **QA lead**, I want automated E2E tests and mutation testing so we maintain test quality and catch regressions. | Playwright E2E covers QR → scan → vote → confirm path. Stryker mutation reports run in CI; failing coverage thresholds block merges.                                                                                                                                           |
| FR035      | Email notifications & admin links                         |                                        As a **poll creator**, I want email with admin links and share bundle so I can distribute and manage the poll offline. | After poll creation, optional email contains secure admin link(s) (signed token or requires login), short URL, and QR download links. Email is sent only if opted-in and logged.                                                                                               |
